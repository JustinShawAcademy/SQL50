## 1581. [Customer Who Visited but Did Not Make Any Transactions](https://leetcode.com/problems/customer-who-visited-but-did-not-make-any-transactions/description/?envType=study-plan-v2&envId=top-sql-50)
* Easy Problem

### SQL Solution
#### Concepts / Syntax
`GROUP BY`, `COUNT()`

#### Intuition

#### Approach
1. We want to join the two tables; `Visits` and `Transactions` on their `visit_id`
    - We do a `LEFT JOIN` because *not all* visits have transactions.
    - As we can see below, `t.transaction_id` has `null` in some cells. This is because that visit did not have a transaction

```sql
SELECT *
FROM Visits v
LEFT JOIN Transactions t
ON v.visit_id = t.visit_id
```
```
| visit_id | customer_id | transaction_id | visit_id | amount |
| -------- | ----------- | -------------- | -------- | ------ |
| 1        | 23          | 12             | 1        | 910    |
| 2        | 9           | 13             | 2        | 970    |
| 4        | 30          | null           | null     | null   |
| 5        | 54          | 2              | 5        | 310    |
| 5        | 54          | 3              | 5        | 300    |
| 5        | 54          | 9              | 5        | 200    |
| 6        | 96          | null           | null     | null   |
| 7        | 54          | null           | null     | null   |
| 8        | 54          | null           | null     | null   |
```

2. We then want to select the rows that only have `transaction_id` as `null`
```sql
SELECT * 
FROM Visits v
LEFT JOIN Transactions t
ON v.visit_id = t.visit_id
WHERE t.transaction_id IS NULL
```
```
| visit_id | customer_id | transaction_id | visit_id | amount |
| -------- | ----------- | -------------- | -------- | ------ |
| 4        | 30          | null           | null     | null   |
| 6        | 96          | null           | null     | null   |
| 7        | 54          | null           | null     | null   |
| 8        | 54          | null           | null     | null   |
```

3. We then can `GROUP BY` v.customer_id so that we may count the occerence of each customer.
```sql
SELECT v.customer_id, COUNT(*) AS count_no_trans
FROM Visits v
LEFT JOIN Transactions t
ON v.visit_id = t.visit_id
WHERE t.transaction_id IS NULL
GROUP BY v.customer_id
```
```
| customer_id | count_no_trans |
| ----------- | -------------- |
| 30          | 1              |
| 54          | 2              |
| 96          | 1              |
```


#### Code
```sql
SELECT v.customer_id, COUNT(*) AS count_no_trans
FROM Visits v
LEFT JOIN Transactions t
ON v.visit_id = t.visit_id
WHERE t.transaction_id IS NULL
GROUP BY v.customer_id
```

### Pandas Solution
#### Concepts / Syntax
`LEFT JOIN` = `pd.merge(..., how="left")`

Get count after groupby: `df.groupby("...").transform("count")`

#### Intuition

#### Approach

#### Code
```py
import pandas as pd

def find_customers(visits: pd.DataFrame, transactions: pd.DataFrame) -> pd.DataFrame:
    df = pd.merge(visits, transactions, on="visit_id", how="left")
    df = df[df["transaction_id"].isna()]
    df["count_no_trans"] = df.groupby("customer_id")["customer_id"].transform("count")
    return df[["customer_id", "count_no_trans"]].drop_duplicates()
```
